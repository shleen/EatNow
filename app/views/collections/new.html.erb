<% if iphone? %>
  <div class='container text-center'>
    <div class='row mt-5'>
        <div class='col-md-12'>
          <h3>Your order is ready!</h3>
          <h6 class='text-muted'>Head to any collection point now.</h6>
        </div>
        <div class='col-md-12'>
          <p class='text-muted'>Order ID: <%= @o.hash_id %></p>
        </div>
    </div>
    <div class='row mt-5'>
      <div class='col-md-12'>
        <button type='button' class='btn btn-secondary btn-collection-point'>I'm at a collection point!</button>
      </div>
    </div>
    <div class='collection-points'>
      <div class='row mt-5'>
        <div class='col-md-12'>
          <h6>Select the collection point you're at!</h6>
        </div>
        <% @collection_points.each do |c| %>
          <div class='col-6 mt-3'>
            <%= link_to c.number, collection_path(number: c.number, order_id: @o.hash_id), method: :post, class: "btn btn-secondary w-75" %>
          </div>
        <% end %>
      </div>
    </div>
  </div>

  <script>
    $('button.btn-collection-point').on('click', () => {
      $('.collection-points').show();
    });
  </script>
<% else %>
  <video autoplay playsinline></video>

  <script>
    const constraints = {video: true};
    const video = $('video');

    if (navigator.mediaDevices && navigator.mediaDevices.getUserMedia) {
      // Looks like we have support, so start camera
      navigator.mediaDevices.getUserMedia(constraints)
        .then(handleSuccess).catch(handleError);
    }
    else {
      alert("man! ur browser isn't supported...");
    }

    function handleSuccess(stream) {
      window.stream = stream; // only to make stream available to console
      video.srcObject = stream;
    }

    function handleError(error) {
      alert('getUserMedia error: ', error);
    }
  </script>
<% end %>
